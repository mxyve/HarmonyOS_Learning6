// å®šä¹‰å­¦ç”Ÿä¿¡æ¯æ¥å£
interface StudentInfo {
  name: string
  id: string
  major: string
  grade: number
}

@Entry
@Component
struct StudentPage {
  // åŸºç¡€çŠ¶æ€
  @State message: string = 'Hello HarmonyOS NEXT'
  @State clickCount: number = 0

  // å­¦ç”Ÿä¿¡æ¯çŠ¶æ€
  @State currentStudent: StudentInfo = {
    name: 'å¼ ä¸‰',
    id: '2024001',
    major: 'è½¯ä»¶å·¥ç¨‹',
    grade: 95
  }

  // UIæ§åˆ¶çŠ¶æ€
  @State showStudentInfo: boolean = false
  @State currentTime: string = ''

  // ç»„ä»¶å³å°†å‡ºç°æ—¶è°ƒç”¨
  aboutToAppear() {
    this.updateCurrentTime()
    // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´
    setInterval(() => {
      this.updateCurrentTime()
    }, 1000)
  }

  // æ›´æ–°å½“å‰æ—¶é—´
  updateCurrentTime() {
    const now = new Date()
    this.currentTime = now.toLocaleString('zh-CN')
  }

  build() {
    Navigation() {
      Column() {
        // é¡¶éƒ¨ä¿¡æ¯æ 
        this.buildTopBar()

        // ä¸»è¦å†…å®¹åŒºåŸŸ
        Scroll() {
          Column({ space: 20 }) {
            // æ¬¢è¿å¡ç‰‡
            this.buildWelcomeCard()

            // åŠŸèƒ½æŒ‰é’®åŒºåŸŸ
            this.buildActionButtons()

            // å­¦ç”Ÿä¿¡æ¯å¡ç‰‡ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰
            if (this.showStudentInfo) {
              this.buildStudentInfoCard()
            }

            // ç»Ÿè®¡ä¿¡æ¯
            this.buildStatsCard()
          }
          .padding(16)
        }
        .flexGrow(1)
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#FFF5F5F5')
    }
    .title('å­¦ç”Ÿä¿¡æ¯')
    .titleMode(NavigationTitleMode.Mini)
    .hideBackButton(false)
  }


  // æ„å»ºé¡¶éƒ¨ä¿¡æ¯æ 
  @Builder buildTopBar() {
    Row() {
      Text('HarmonyOS å­¦ä¹ ')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .fontColor('#FFFFFFFF')

      Blank()

      Text(this.currentTime)
        .fontSize(14)
        .fontColor('#FFFFFFFF')
    }
    .width('100%')
    .height(60)
    .padding({ left: 16, right: 16 })
    .backgroundColor('#FF007DFF')
    .alignItems(VerticalAlign.Center)
  }

  // æ„å»ºæ¬¢è¿å¡ç‰‡
  @Builder buildWelcomeCard() {
    Column() {
      Column({ space: 12 }) {
        Text('ğŸ‰ æ¬¢è¿æ¥åˆ°é¸¿è’™ä¸–ç•Œï¼')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor('#FF333333')

        Text(this.message)
          .fontSize(16)
          .fontColor('#FF666666')
          .textAlign(TextAlign.Center)
          .width('100%')
      }
      .padding(20)
    }
    .width('100%')
    .backgroundColor('#FFFFFFFF')
    .borderRadius(12)
  }

  // æ„å»ºåŠŸèƒ½æŒ‰é’®åŒºåŸŸ
  @Builder buildActionButtons() {
    Row({ space: 16 }) {
      Button('ç‚¹å‡»ä½“éªŒ')
        .fontSize(16)
        .flexGrow(1)
        .height(50)
        .backgroundColor('#FF007DFF')
        .borderRadius(8)
        .onClick(() => {
          this.handleMainButtonClick()
        })

      Button(this.showStudentInfo ? 'éšè—ä¿¡æ¯' : 'æ˜¾ç¤ºä¿¡æ¯')
        .fontSize(16)
        .flexGrow(1)
        .height(50)
        .backgroundColor('#FF00C853')
        .borderRadius(8)
        .onClick(() => {
          this.showStudentInfo = !this.showStudentInfo
        })
    }
    .width('100%')
  }

  // æ„å»ºå­¦ç”Ÿä¿¡æ¯å¡ç‰‡
  @Builder buildStudentInfoCard() {
    Column() {
      Column({ space: 16 }) {
        Text('ğŸ“š å­¦ç”Ÿä¿¡æ¯')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor('#FF333333')

        Column({ space: 8 }) {
          this.buildInfoRow('å§“å', this.currentStudent.name)
          this.buildInfoRow('å­¦å·', this.currentStudent.id)
          this.buildInfoRow('ä¸“ä¸š', this.currentStudent.major)
          this.buildInfoRow('æˆç»©', `${this.currentStudent.grade}åˆ†`)
        }
        .alignItems(HorizontalAlign.Start)
        .width('100%')

        // æˆç»©ç­‰çº§æ˜¾ç¤º
        Row() {
          Text('ç­‰çº§ï¼š')
            .fontSize(16)
            .fontColor('#FF666666')

          Text(this.getGradeLevel(this.currentStudent.grade))
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor(this.getGradeColor(this.currentStudent.grade))
        }
        .width('100%')
      }
      .padding(20)
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .backgroundColor('#FFFFFFFF')
    .borderRadius(12)
  }

  // æ„å»ºä¿¡æ¯è¡Œ
  @Builder buildInfoRow(label: string, value: string) {
    Row() {
      Text(`${label}ï¼š`)
        .fontSize(16)
        .fontColor('#FF666666')
        .width(60)

      Text(value)
        .fontSize(16)
        .fontColor('#FF333333')
        .flexGrow(1)
    }
    .width('100%')
  }

  // æ„å»ºç»Ÿè®¡ä¿¡æ¯å¡ç‰‡
  @Builder buildStatsCard() {
    Column() {
      Column({ space: 16 }) {
        Text('ğŸ“Š ä½¿ç”¨ç»Ÿè®¡')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor('#FF333333')

        Row() {
          Column() {
            Text(`${this.clickCount}`)
              .fontSize(32)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FF007DFF')

            Text('ç‚¹å‡»æ¬¡æ•°')
              .fontSize(14)
              .fontColor('#FF666666')
          }
          .flexGrow(1)

          Column() {
            Text(this.getEngagementLevel())
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FF00C853')

            Text('å‚ä¸åº¦')
              .fontSize(14)
              .fontColor('#FF666666')
          }
          .flexGrow(1)
        }

        if (this.clickCount > 0) {
          Button('é‡ç½®ç»Ÿè®¡')
            .fontSize(14)
            .width('100%')
            .height(40)
            .backgroundColor('#FFFF9500')
            .borderRadius(8)
            .onClick(() => {
              this.resetAll()
            })
        }
      }
      .padding(20)
    }
    .width('100%')
    .backgroundColor('#FFFFFFFF')
    .borderRadius(12)
  }

  // å¤„ç†ä¸»æŒ‰é’®ç‚¹å‡»
  handleMainButtonClick() {
    this.clickCount++

    const messages = [
      'å¤ªæ£’äº†ï¼ä½ å­¦ä¼šäº†HarmonyOSå¼€å‘ï¼',
      'ç»§ç»­æ¢ç´¢ï¼Œå‘ç°æ›´å¤šå¯èƒ½ï¼',
      'ä½ çœŸæ˜¯ä¸ªå‹¤å¥‹çš„å­¦ä¹ è€…ï¼',
      'HarmonyOSçš„ä¸–ç•Œå¾ˆç²¾å½©ï¼',
      'æ­å–œä½ ï¼å·²ç»æ˜¯HarmonyOSä¸“å®¶äº†ï¼'
    ]

    const randomIndex = Math.floor(Math.random() * messages.length)
    this.message = messages[randomIndex]
  }

  // è·å–æˆç»©ç­‰çº§
  getGradeLevel(score: number): string {
    if (score >= 90) return 'ä¼˜ç§€'
    if (score >= 80) return 'è‰¯å¥½'
    if (score >= 70) return 'ä¸­ç­‰'
    if (score >= 60) return 'åŠæ ¼'
    return 'ä¸åŠæ ¼'
  }

  // è·å–æˆç»©é¢œè‰²
  getGradeColor(score: number): string {
    if (score >= 90) return '#FF00C853'  // ç»¿è‰²
    if (score >= 80) return '#FF2196F3'  // è“è‰²
    if (score >= 70) return '#FFFF9500'  // æ©™è‰²
    if (score >= 60) return '#FFFF5722'  // æ·±æ©™è‰²
    return '#FFF44336'                   // çº¢è‰²
  }

  // è·å–å‚ä¸åº¦ç­‰çº§
  getEngagementLevel(): string {
    if (this.clickCount === 0) return 'æ–°æ‰‹'
    if (this.clickCount < 5) return 'å…¥é—¨'
    if (this.clickCount < 10) return 'ç†Ÿç»ƒ'
    if (this.clickCount < 20) return 'ä¸“å®¶'
    return 'å¤§å¸ˆ'
  }

  // é‡ç½®æ‰€æœ‰çŠ¶æ€
  resetAll() {
    this.clickCount = 0
    this.message = 'Hello HarmonyOS NEXT'
    this.showStudentInfo = false
  }
}